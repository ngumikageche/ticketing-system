#!/bin/bash

APP_NAME="support-ticketing-dashboard"
CONTAINER_NAME="support-dashboard-container"
PORT_MAPPING="3000:3000"

# Function to print status messages
print_step() {
  echo -e "\nüî∑ \033[1;34m$1...\033[0m"
}

print_success() {
  echo -e "‚úÖ \033[1;32m$1\033[0m"
}

print_error() {
  echo -e "‚ùå \033[1;31m$1\033[0m"
}

print_divider() {
  echo "--------------------------------------------------"
}

echo -e "\nüöÄ \033[1;36mStarting Docker Deployment for $APP_NAME\033[0m"
print_divider

# Step 1: Build image
print_step "Step 1/3: Building Docker image [$APP_NAME]"
if docker build -t "$APP_NAME" .; then
  print_success "Image built successfully."
else
  print_error "Docker build failed."
  exit 1
fi

# Step 2: Stop and remove existing container
print_step "Step 2/3: Removing existing container [$CONTAINER_NAME] if exists"
if docker ps -a --format '{{.Names}}' | grep -Eq "^${CONTAINER_NAME}\$"; then
  docker stop "$CONTAINER_NAME" && docker rm "$CONTAINER_NAME" && \
    print_success "Old container removed."
else
  echo "‚ÑπÔ∏è  No existing container found."
fi

# Step 3: Run new container
print_step "Step 3/3: Starting new container [$CONTAINER_NAME]"
if docker run -d -p "$PORT_MAPPING" --name "$CONTAINER_NAME" "$APP_NAME"; then
  print_success "Container is running!"
  echo -e "üåç Access it at: \033[1;33mhttp://localhost:${PORT_MAPPING%%:*}\033[0m"
else
  print_error "Failed to start container."
  exit 1
fi

print_divider
echo -e "üéâ \033[1;36mDeployment completed successfully!\033[0m"